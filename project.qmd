---
title: DANL Project
subtitle: "Climate Finance"
author: 
  - Ann Brennan
  - Alex Ventresca
  - Drew Cox

toc: true
toc-title: "Table of Contents"
toc-depth: 2
number-sections: true

fig-width: 9

execute:
  code-tools: true
  message: false
  warning: false

from: markdown+emoji
---

```{r setup}
#| include: false
library(tidyverse)
library(skimr)
library(ggthemes)
library(hrbrthemes)

theme_set(theme_ipsum()+
          theme(strip.background =element_rect(fill="lightgray"),
                axis.title.x = 
                  element_text(angle = 0,
                               size = rel(1.33),
                               margin = margin(10,0,0,0)),
                axis.title.y = 
                  element_text(angle = 0,
                               size = rel(1.33),
                               margin = margin(0,10,0,0))
                )
          )
```

# Introduction

About this project :clap:

# Data

```{r}
path <- 'https://bcdanl.github.io/data/climate_finance_energy.csv'
climate_finance <- read_csv(path)
```

## Variable Description

-   **Party:** a party (country) that provides a funding contribution to recipient country/region for their cliamte change project.

-   **Recipient country/region:** Recipient country or region

-   **Project/programme/activity:** Details in the climate change project

-   **Type of support:**

    -   adaptation if the climate change project is related to adaptation project.

    -   mitigation if the climate change project is related to mitigation project.

-   **Year:** Year that funding contribution is committed or provided.

-   **Contribution:** An amount of funding contribution for the climate change project (in USD).

-   **Status:**

    -   committed if a party commits to providing the funding contribution for the climate change project, but the funding contribution is NOT actually provided.

    -   provided if the funding contribution was provided for the climate change project.

-   **Energy:**

    -   TRUE if the project is energy-related;

    -   FALSE otherwise.

## Summary Statistics

```{r}
#| results: asis
#| echo: false
rmarkdown::paged_table(climate_finance) 
```

```{r}
skim(climate_finance) %>% 
  select(-n_missing)
```

# Analysis

## Financial Contributions to Other Countries

Various parties in the climate_finance data frame have made positive financial contributions to other countries for adaptation projects. Here, we will find the number of parties that made a positive contribution to another country for every year between 2011 and 2018.

```{r}
positive_contributions <- climate_finance %>% 
  filter(Status == "provided",                       
         `Type of support` == "adaptation") %>%      
  group_by(Party, Year) %>%                          
  summarise(Contribution = sum(Contribution, na.rm = T)) %>%  
  filter(Contribution > 0) %>%                       
  group_by(Party) %>%                                
  count() %>%                                        
  filter(n == 2018 - 2011 + 1)  %>%                  
  select(Party) %>% 
  distinct()    
```
```{r}
nrow(positive_contributions)
```
## Types of Contributions

There are two different types of contributions that a party can make: adaptation and mitigation. The type of contribution is decided based on the type of project it supports. Adaptation contributions go to an adaptation climate change project. A mitigation contribution goes to a mitigation climate change project.

First, we will calculate the ratio between adaptation contribution and mitigation contribution for each type of Status for each Party each year.

```{r}
ratio <- climate_finance %>% 
  group_by(Party, Year, Status, `Type of support`) %>% 
  summarise(Contribution = sum(Contribution, na.rm = T)) %>% 
  filter(Contribution != 0) %>% 
  group_by(Party, Year, Status) %>% 
  mutate(lag_Contribution = lag(Contribution), 
         am_ratio = lag_Contribution / Contribution ) %>% 
  filter(!is.na(am_ratio)) %>% 
  rename(mitigation = Contribution, 
         adaptation = lag_Contribution) %>% 
  select(-`Type of support`) 
```

Here, we will visualize the distribution of the ratio between adaption contribution and mitigation contribution based on our calculation.

```{r}
ggplot(ratio, aes(x = log(am_ratio))) +
  geom_histogram(bins = 75) + labs(x = "log(ratio)", y = "count", title = "Distribution of the Ratio of Contributions") +
  geom_vline(xintercept = 0, color = 'red', lty = 2)
```

This histogram depicts a generally normal distribution of the ratio between adaptation contribution and mitigation contribution.
